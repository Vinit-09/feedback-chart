<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback Distribution Summary</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM (Stable 18.2.0) -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX parsing -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Dependencies for Recharts -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <!-- Recharts (Stable 2.12.7) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #f8fafc; overflow-x: hidden; }
        .recharts-default-legend { padding-top: 12px !important; }
        #root { min-height: 100vh; }
        .recharts-bar-rectangle { transition: all 0.3s ease; }
        /* High contrast focus outline for accessibility */
        .recharts-bar-rectangle:focus { outline: 2px solid #2563eb; }
        /* Screen reader only utility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex items-center justify-center h-screen bg-slate-50">
            <div class="text-slate-400 animate-pulse font-sans">Loading visualization...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useMemo, useEffect } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer 
        } = Recharts;

        const App = () => {
            if (typeof Recharts === 'undefined') {
                return (
                    <div className="flex items-center justify-center h-screen bg-slate-50 p-4">
                        <div className="text-center p-6 bg-white shadow-md rounded-lg border border-red-100 max-w-sm">
                            <h2 className="text-red-600 font-bold text-lg mb-2">Error</h2>
                            <p className="text-slate-600 text-sm">Failed to load charting libraries. Please check your connection.</p>
                        </div>
                    </div>
                );
            }

            const data = [
                {
                    month: "Oct '25",
                    'Defect/Bug': 52,
                    'Feature Request': 21,
                    'Usability': 18,
                    'Performance': 11,
                    'Configuration': 9,
                    'Flakiness': 6,
                    'Learning/Doc': 5,
                },
                {
                    month: "Nov '25",
                    'Defect/Bug': 59,
                    'Feature Request': 27,
                    'Usability': 11,
                    'Performance': 9,
                    'Configuration': 11,
                    'Flakiness': 8,
                    'Learning/Doc': 7,
                }
            ];

            const categoryConfig = [
                { key: 'Defect/Bug', color: '#dc2626' }, // Improved contrast red
                { key: 'Feature Request', color: '#2563eb' }, // Improved contrast blue
                { key: 'Usability', color: '#059669' }, // Improved contrast green
                { key: 'Performance', color: '#d97706' }, // Improved contrast amber
                { key: 'Configuration', color: '#7c3aed' }, // Improved contrast purple
                { key: 'Flakiness', color: '#db2777' }, // Improved contrast pink
                { key: 'Learning/Doc', color: '#475569' }, // Improved contrast slate
            ];

            const totals = useMemo(() => {
                const octTotal = Object.values(data[0]).reduce((acc, val) => typeof val === 'number' ? acc + val : acc, 0);
                const novTotal = Object.values(data[1]).reduce((acc, val) => typeof val === 'number' ? acc + val : acc, 0);
                const diff = novTotal - octTotal;
                const percentChange = ((diff / octTotal) * 100).toFixed(1);
                return { octTotal, novTotal, diff, percentChange };
            }, []);

            useEffect(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }, []);

            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    const total = payload.reduce((sum, entry) => sum + entry.value, 0);
                    return (
                        <div className="bg-white p-3 border border-slate-200 shadow-xl rounded-lg text-sm" role="status" aria-live="polite">
                            <p className="font-bold text-slate-800 mb-1 border-b border-slate-100 pb-1">{label}</p>
                            <div className="space-y-1">
                                {payload.map((entry, index) => (
                                    <div key={index} className="flex justify-between items-center gap-6">
                                        <span className="flex items-center gap-2">
                                            <div className="w-2.5 h-2.5 rounded-sm" style={{ backgroundColor: entry.color }} />
                                            <span className="text-slate-600">{entry.name}:</span>
                                        </span>
                                        <span className="font-mono font-bold text-slate-900">{entry.value}</span>
                                    </div>
                                ))}
                            </div>
                            <div className="mt-2 pt-2 border-t border-slate-100 flex justify-between font-bold text-slate-900">
                                <span>Total:</span>
                                <span>{total}</span>
                            </div>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="p-2 md:p-4 font-sans max-w-6xl mx-auto space-y-4">
                    {/* Compact Totals Header */}
                    <div className="flex gap-3 items-center">
                        <div className="bg-white px-3 py-1.5 rounded-lg shadow-sm border border-slate-200 flex items-center gap-3">
                            <span className="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Oct Total</span>
                            <span className="text-lg font-black text-slate-900">{totals.octTotal}</span>
                        </div>
                        <div className="bg-white px-3 py-1.5 rounded-lg shadow-sm border border-slate-200 flex items-center gap-3">
                            <span className="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Nov Total</span>
                            <span className="text-lg font-black text-slate-900">{totals.novTotal}</span>
                        </div>
                        <div className={`ml-auto px-2 py-1 rounded text-xs font-bold ${totals.diff >= 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-red-50 text-red-700'}`}>
                            {totals.diff >= 0 ? '↑' : '↓'} {Math.abs(totals.diff)} ({totals.percentChange}%)
                        </div>
                    </div>

                    {/* Compact Insight */}
                    <div className="bg-blue-50/50 border border-blue-100 p-3 rounded-lg flex gap-3 items-center">
                        <i data-lucide="info" className="text-blue-500 shrink-0 w-4 h-4"></i>
                        <p className="text-xs text-blue-900 leading-tight">
                            Feedback increased by <span className="font-bold">{totals.diff} units</span>. 
                            Growth led by <span className="font-bold text-red-700">Defect/Bug</span> and <span className="font-bold text-blue-700">Feature Requests</span>.
                        </p>
                    </div>

                    {/* Chart Section */}
                    <div 
                        className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 h-[400px] w-full"
                        role="region"
                        aria-label="Stacked bar chart showing feedback category distribution for October and November 2025"
                    >
                        <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                <XAxis 
                                    dataKey="month" 
                                    axisLine={false} 
                                    tickLine={false} 
                                    tick={{ fill: '#64748b', fontSize: 12, fontWeight: 700 }} 
                                    dy={10} 
                                />
                                <YAxis 
                                    axisLine={false} 
                                    tickLine={false} 
                                    tick={{ fill: '#94a3b8', fontSize: 11 }} 
                                />
                                <Tooltip content={<CustomTooltip />} cursor={{ fill: '#f1f5f9', opacity: 0.5 }} />
                                <Legend 
                                    verticalAlign="bottom" 
                                    height={36} 
                                    iconType="rect" 
                                    wrapperStyle={{ fontSize: '11px', fontWeight: 500, paddingTop: '10px' }}
                                />
                                {categoryConfig.map((cat) => (
                                    <Bar 
                                        key={cat.key} 
                                        dataKey={cat.key} 
                                        stackId="a" 
                                        fill={cat.color} 
                                        barSize={60}
                                        aria-label={cat.key}
                                    />
                                ))}
                            </BarChart>
                        </ResponsiveContainer>
                    </div>

                    {/* Accessible Screen Reader Table (Hidden) */}
                    <table className="sr-only">
                        <caption>Feedback distribution data for October and November 2025</caption>
                        <thead>
                            <tr>
                                <th>Month</th>
                                {categoryConfig.map(cat => <th key={cat.key}>{cat.key}</th>)}
                            </tr>
                        </thead>
                        <tbody>
                            {data.map(row => (
                                <tr key={row.month}>
                                    <td>{row.month}</td>
                                    {categoryConfig.map(cat => <td key={cat.key}>{row[cat.key]}</td>)}
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    {/* Compact Breakdown Grid */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 pb-4">
                        {data.map((monthData, idx) => (
                            <div key={idx} className="bg-white rounded-lg border border-slate-200 overflow-hidden">
                                <div className="bg-slate-50 px-3 py-2 border-b border-slate-200 flex justify-between items-center">
                                    <span className="font-bold text-xs text-slate-700 uppercase tracking-tight">{monthData.month}</span>
                                    <span className="text-[10px] font-mono font-bold text-slate-400">TOTAL: {Object.values(monthData).reduce((a, b) => typeof b === 'number' ? a + b : a, 0)}</span>
                                </div>
                                <div className="p-3 space-y-2">
                                    {categoryConfig.map(cat => (
                                        <div key={cat.key} className="flex items-center justify-between text-[11px]">
                                            <span className="text-slate-500 font-medium truncate w-24">{cat.key}</span>
                                            <div className="flex-1 px-4">
                                                <div className="h-1 bg-slate-100 rounded-full overflow-hidden">
                                                    <div 
                                                        className="h-full rounded-full" 
                                                        style={{ 
                                                            backgroundColor: cat.color, 
                                                            width: `${(monthData[cat.key] / 70) * 100}%` 
                                                        }} 
                                                    />
                                                </div>
                                            </div>
                                            <span className="font-mono text-slate-900 w-4 text-right font-bold">{monthData[cat.key]}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
